// src/Loader.jsx
import React, { useEffect, useState, useRef } from "react";
import "./loader.css";

const messages = [
  "Fueling Innovation...",
  "Collaborate. Create. Compute.",
  "Empowering Innovators Since 2020",
  "Proud home of 100+ active members",
  "Coding the Future Together!",
];

const messageDuration = 1600;

export default function Loader({ onFinish }) {
  const [messageIndex, setMessageIndex] = useState(0);
  const [progressPercent, setProgressPercent] = useState(0);
  const [showLoader, setShowLoader] = useState(true);
  const [fadeFooterAndProgress, setFadeFooterAndProgress] = useState(false);
  const loaderRef = useRef(null);
  const timeoutRef = useRef(null);

  useEffect(() => {
    let currentIndex = 0;

    function nextStep() {
      setMessageIndex(currentIndex);
      setProgressPercent(((currentIndex + 1) / messages.length) * 100);

      currentIndex++;
      if (currentIndex < messages.length) {
        timeoutRef.current = setTimeout(nextStep, messageDuration);
      } else {
        timeoutRef.current = setTimeout(() => {
          setFadeFooterAndProgress(true);
          setTimeout(() => {
            setShowLoader(false);
          }, 900);
        }, 900);
      }
    }

    nextStep();

    return () => clearTimeout(timeoutRef.current);
  }, []);

  useEffect(() => {
    if (!showLoader && loaderRef.current) {
      const el = loaderRef.current;
      function onTransitionEnd() {
        el.style.display = "none";
        if (typeof onFinish === "function") onFinish();
        el.removeEventListener("transitionend", onTransitionEnd);
      }
      el.addEventListener("transitionend", onTransitionEnd);
    }
  }, [showLoader, onFinish]);

  return (
    <div
      id="loader-overlay"
      className={`loader-overlay ${showLoader ? "" : "fade-out"}`}
      ref={loaderRef}
      style={{ display: showLoader ? "flex" : undefined }}
    >
      <div className="loader-container">
        <div className="logo-wrapper">
          <svg
            className="loader-svg"
            version="1.0"
            xmlns="http://www.w3.org/2000/svg"
            width="662.000000pt"
            height="328.000000pt"
            viewBox="0 0 662.000000 328.000000"
            preserveAspectRatio="xMidYMid meet"
          >
            {/* Full SVG paths copied from your original */}
            <g
              transform="translate(0.000000,328.000000) scale(0.100000,-0.100000)"
              fill="#2196F3"
              stroke="none"
            >
              <path
                d="M491 2396 l-474 -474 237 -244 c130 -134 346 -350 480 -480 l243
-236 304 304 304 304 -125 0 -125 0 -182 -182 -183 -183 -355 355 -355 355
357 357 358 358 180 -180 180 -180 120 0 120 0 -300 300 c-165 165 -302 300
-305 300 -3 0 -218 -213 -479 -474z"
              />
              <path
                d="M2385 2393 l-476 -477 480 -480 481 -481 307 308 308 307 -125 0
-125 0 -182 -182 -183 -183 -357 358 -358 357 358 357 357 358 183 -183 182
-182 120 0 120 0 -300 300 c-165 165 -303 300 -306 300 -4 0 -221 -215 -484
-477z"
              />
              <path
                d="M3690 1910 l0 -960 610 0 610 0 0 85 0 85 -515 0 -515 0 0 370 0 370
465 0 465 0 0 85 0 85 -465 0 -465 0 0 335 0 335 495 0 495 0 0 85 0 85 -590
0 -590 0 0 -960z"
              />
              <path
                d="M5070 2785 l0 -85 325 0 325 0 0 -875 0 -875 95 0 95 0 0 875 0 875
320 0 320 0 0 85 0 85 -740 0 -740 0 0 -85z"
              />
              <path
                d="M547 2066 c-59 -16 -60 -18 -45 -50 9 -21 16 -26 32 -21 75 25 146 8
146 -34 0 -16 -11 -19 -75 -23 -61 -4 -80 -9 -100 -28 -29 -28 -34 -83 -10
-117 30 -43 118 -51 173 -15 20 13 22 13 22 -2 0 -12 10 -16 41 -16 l41 0 -4
113 c-5 122 -17 161 -58 182 -40 21 -110 26 -163 11z m133 -200 c0 -44 -77
-75 -108 -44 -16 16 -15 55 1 61 6 3 33 6 60 6 43 1 47 -1 47 -23z"
              />
              <path
                d="M964 2070 c-49 -11 -90 -46 -108 -90 -21 -52 -20 -85 3 -136 44 -97
191 -122 265 -45 l28 29 -31 17 c-30 15 -33 15 -58 -5 -30 -24 -54 -25 -92 -5
-33 16 -41 33 -41 80 0 47 8 64 41 80 38 20 62 19 92 -5 25 -20 28 -20 58 -5
l31 17 -28 29 c-40 42 -94 55 -160 39z"
              />
              <path
                d="M1325 2061 c-47 -25 -45 -25 -45 -6 0 11 -11 15 -40 15 l-40 0 0
-155 0 -155 45 0 45 0 0 98 c0 116 12 142 65 142 57 0 65 -18 65 -136 l0 -104
45 0 45 0 0 98 c0 116 12 142 65 142 57 0 65 -18 65 -136 l0 -104 46 0 46 0
-4 119 c-5 134 -16 163 -75 187 -43 18 -102 11 -137 -17 -25 -20 -26 -20 -54
1 -42 31 -90 35 -137 11z"
              />
              <path
                d="M765 880 l210 -210 203 203 202 202 -82 3 -82 3 -121 -121 -120 -120
-125 125 -125 125 -85 0 -85 0 210 -210z"
              />
              <path
                d="M2146 800 c-46 -14 -66 -39 -66 -81 0 -44 21 -63 85 -80 76 -19 95
-30 95 -55 0 -43 -68 -58 -137 -29 -29 12 -38 13 -45 3 -4 -7 -8 -16 -8 -19 0
-15 69 -34 122 -34 73 0 112 26 116 78 4 46 -23 71 -92 88 -75 17 -88 26 -84
57 4 37 44 50 105 34 37 -10 48 -10 55 0 13 22 10 25 -36 37 -51 13 -69 13
-110 1z"
              />
              <path
                d="M4503 801 c-78 -20 -117 -69 -117 -147 0 -61 21 -97 75 -129 56 -33
183 -19 196 21 6 20 -27 25 -57 9 -61 -32 -129 -6 -155 58 -15 37 -15 44 0 83
25 65 93 91 155 59 30 -16 63 -11 57 9 -9 28 -100 50 -154 37z"
              />
              <path
                d="M2330 781 c0 -17 8 -20 53 -23 l52 -3 3 -122 3 -123 24 0 25 0 0 125
0 125 50 0 c43 0 50 3 50 20 0 19 -7 20 -130 20 -122 0 -130 -1 -130 -19z"
              />
              <path
                d="M2631 708 c1 -155 32 -202 134 -202 102 0 133 47 134 202 1 92 1 92
-24 92 -25 0 -25 -1 -25 -89 0 -48 -5 -102 -10 -118 -24 -68 -126 -68 -150 0
-5 16 -10 70 -10 118 0 88 0 89 -25 89 -25 0 -25 0 -24 -92z"
              />
              <path
                d="M2990 655 l0 -148 93 5 c143 8 197 46 197 143 0 97 -54 135 -197 143
l-93 5 0 -148z m173 96 c43 -17 67 -51 67 -96 0 -69 -48 -105 -141 -105 l-49
0 0 105 0 105 49 0 c27 0 61 -4 74 -9z"
              />
              <path
                d="M3360 655 l0 -145 110 0 c103 0 110 1 110 20 0 18 -7 20 -85 20 l-85
0 0 40 0 40 75 0 c68 0 75 2 75 20 0 18 -7 20 -75 20 l-75 0 0 45 0 45 85 0
c78 0 85 2 85 20 0 19 -7 20 -110 20 l-110 0 0 -145z"
              />
              <path
                d="M3660 655 l0 -145 25 0 25 0 0 100 0 100 87 -97 c54 -62 95 -99 110
-101 l23 -3 0 145 0 146 -25 0 c-25 0 -25 0 -25 -95 0 -52 -4 -95 -9 -95 -5 0
-46 43 -92 95 -116 132 -119 131 -119 -50z"
              />
              <path
                d="M3970 781 c0 -17 8 -20 53 -23 l52 -3 3 -122 3 -123 24 0 25 0 0 125
0 125 50 0 c43 0 50 3 50 20 0 19 -7 20 -130 20 -122 0 -130 -1 -130 -19z"
              />
              <path
                d="M4730 655 l0 -145 25 0 c24 0 25 3 25 60 l0 60 80 0 80 0 0 -60 c0
-57 1 -60 25 -60 l25 0 0 145 0 145 -25 0 c-24 0 -25 -2 -25 -65 l0 -65 -80 0
-80 0 0 65 c0 63 -1 65 -25 65 l-25 0 0 -145z"
              />
              <path
                d="M5117 663 c-37 -76 -67 -141 -67 -145 0 -5 10 -8 23 -8 17 0 28 10
40 35 l17 35 78 0 78 0 17 -35 c13 -27 23 -35 43 -35 14 0 24 4 22 8 -1 5 -32
70 -68 145 -58 123 -68 137 -91 137 -23 0 -32 -14 -92 -137z m127 15 l25 -58
-60 0 c-34 0 -59 4 -57 8 2 4 14 33 27 65 14 31 28 54 32 50 4 -5 19 -34 33
-65z"
              />
              <path
                d="M5430 656 l0 -146 25 0 c22 0 25 4 25 39 l0 38 66 6 c79 8 108 24
124 71 9 27 8 41 -4 69 -20 48 -45 59 -148 65 l-88 5 0 -147z m175 79 c14 -13
25 -31 25 -40 0 -9 -11 -27 -25 -40 -19 -20 -34 -25 -75 -25 l-50 0 0 65 0 65
50 0 c41 0 56 -5 75 -25z"
              />
              <path
                d="M5690 781 c0 -17 8 -20 53 -23 l52 -3 3 -122 3 -123 24 0 25 0 0 125
0 125 50 0 c43 0 50 3 50 20 0 19 -7 20 -130 20 -122 0 -130 -1 -130 -19z"
              />
              <path
                d="M6010 655 l0 -145 110 0 c103 0 110 1 110 20 0 18 -7 20 -85 20 l-85
0 0 40 0 40 75 0 c68 0 75 2 75 20 0 18 -7 20 -75 20 l-75 0 0 45 0 45 85 0
c78 0 85 2 85 20 0 19 -7 20 -110 20 l-110 0 0 -145z"
              />
              <path
                d="M6300 655 l0 -145 25 0 c23 0 25 4 25 45 l0 45 43 0 c39 0 44 -4 72
-45 24 -35 36 -45 58 -45 l29 0 -35 48 -36 48 32 25 c27 22 32 32 31 68 -2 73
-51 100 -181 101 l-63 0 0 -145z m176 80 c18 -19 23 -31 19 -48 -11 -35 -35
-47 -92 -47 l-53 0 0 60 0 60 50 0 c41 0 56 -5 76 -25z"
              />
              <path
                d="M770 585 l205 -205 203 202 202 203 -82 3 -82 3 -123 -123 -123 -123
-123 123 -122 122 -80 0 -80 0 205 -205z"
              />
              <path
                d="M2060 400 c0 -20 7 -20 2250 -20 2243 0 2250 0 2250 20 0 20 -7 20
-2250 20 -2243 0 -2250 0 -2250 -20z"
              />
              <path
                d="M5230 275 c0 -8 -7 -15 -15 -15 -8 0 -15 -4 -15 -10 0 -5 7 -10 15
-10 11 0 15 -12 15 -45 0 -35 5 -47 21 -55 22 -12 49 -7 49 9 0 5 -8 8 -17 7
-14 -1 -19 8 -21 42 -3 37 -1 42 17 42 12 0 21 5 21 10 0 6 -9 10 -20 10 -11
0 -20 7 -20 15 0 8 -7 15 -15 15 -8 0 -15 -7 -15 -15z"
              />
              <path
                d="M4760 263 c-51 -19 -66 -75 -30 -108 24 -21 84 -25 102 -7 17 17 3
26 -20 13 -34 -18 -72 2 -72 39 0 37 38 57 72 39 21 -12 37 -4 22 10 -13 13
-56 21 -74 14z"
              />
              <path
                d="M4920 263 c-51 -19 -66 -75 -30 -108 24 -21 84 -25 102 -7 17 17 3
26 -20 13 -34 -18 -72 2 -72 39 0 37 38 57 72 39 21 -12 37 -4 22 10 -13 13
-56 21 -74 14z"
              />
              <path
                d="M5080 261 c-14 -4 -32 -19 -40 -34 -13 -24 -13 -30 0 -54 18 -32 67
-47 105 -33 14 5 24 14 20 20 -4 6 -15 5 -30 -2 -20 -9 -29 -7 -52 8 l-28 19
63 3 c67 3 76 13 45 50 -22 24 -49 32 -83 23z m56 -25 c26 -20 14 -28 -37 -24
-41 3 -42 4 -25 21 21 21 36 22 62 3z"
              />
              <path
                d="M5433 263 c-13 -2 -23 -9 -23 -15 0 -6 12 -8 31 -4 31 6 69 -7 69
-24 0 -6 -18 -10 -39 -10 -40 0 -75 -22 -68 -44 7 -22 53 -37 81 -26 17 6 26
6 26 0 0 -6 7 -10 15 -10 19 0 21 88 3 113 -14 18 -59 28 -95 20z m77 -81 c0
-15 -24 -32 -46 -32 -25 0 -39 14 -29 30 7 12 75 14 75 2z"
              />
              <path
                d="M5630 263 c-51 -19 -66 -75 -30 -108 24 -21 84 -25 102 -7 17 17 3
26 -20 13 -34 -18 -72 2 -72 39 0 37 38 57 72 39 21 -12 37 -4 22 10 -13 13
-56 21 -74 14z"
              />
              <path
                d="M5760 200 c0 -54 3 -70 14 -70 11 0 16 15 18 53 3 50 4 52 33 52 29
0 30 -2 33 -52 2 -38 7 -53 18 -53 10 0 14 12 14 44 0 49 17 69 52 64 20 -3
23 -9 26 -55 2 -38 7 -53 18 -53 10 0 14 14 14 55 0 47 -3 57 -25 71 -20 13
-30 14 -59 4 -27 -8 -40 -8 -57 0 -16 9 -28 9 -47 0 -19 -8 -28 -8 -30 -1 -2
6 -8 11 -13 11 -5 0 -9 -31 -9 -70z"
              />
              <path
                d="M6160 263 c-78 -30 -59 -127 25 -127 90 0 103 109 15 128 -14 2 -32
2 -40 -1z m51 -23 c30 -16 26 -68 -7 -80 -36 -14 -64 3 -64 40 0 41 33 60 71
40z"
              />
              <path
                d="M6300 200 c0 -54 3 -70 14 -70 11 0 16 14 18 48 2 38 7 49 26 57 12
5 22 15 22 22 0 16 -6 16 -31 3 -13 -7 -19 -7 -19 0 0 5 -7 10 -15 10 -12 0
-15 -14 -15 -70z"
              />
              <path
                d="M6442 260 c-29 -12 -44 -52 -32 -85 10 -27 44 -40 90 -33 37 6 41
-17 6 -33 -18 -8 -33 -8 -55 -1 -25 9 -31 8 -31 -2 0 -16 59 -29 86 -20 45 16
54 34 54 111 0 58 -3 73 -15 73 -8 0 -15 -4 -15 -10 0 -6 -9 -6 -26 0 -30 12
-32 12 -62 0z m80 -34 c22 -32 -1 -66 -44 -66 -21 0 -32 7 -40 26 -11 23 -10
29 11 45 24 20 59 17 73 -5z"
              />
              <path d="M5334 159 c-7 -12 15 -31 28 -23 4 3 8 12 8 20 0 17 -26 19 -36 3z" />
              <path d="M6040 156 c0 -8 4 -17 8 -20 13 -8 35 11 28 23 -10 16 -36 14 -36 -3z" />
              {/* add the rest of your paths here */
              /* truncated here for brevity; include all your paths */}
            </g>
          </svg>
          <div className="loader-shadow"></div>
        </div>

        {/* Progress bar */}
        <div
          className={`progress-container ${
            fadeFooterAndProgress ? "fade-out" : ""
          }`}
          aria-label="Loading progress"
          role="progressbar"
          aria-valuemin={0}
          aria-valuemax={100}
          aria-valuenow={progressPercent}
        >
          <div
            className="progress-fill"
            style={{ width: `${progressPercent}%` }}
          />
        </div>

        {/* Loading messages */}
        <div
          className={`loading-footer ${
            fadeFooterAndProgress ? "fade-out" : ""
          }`}
          aria-live="polite"
        >
          <span className="loading-message" key={messageIndex}>
            {messages[messageIndex]}
          </span>
        </div>
      </div>
    </div>
  );
}
